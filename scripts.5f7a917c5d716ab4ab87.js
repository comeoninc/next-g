!function(t,e){document.MBLOADED||("function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(a){return e(t,a)}):t.Mobilebone=e(t,{}))}(this,function(t,e){if(document.MBLOADED)return"Don't repeat load Mobilebone!";var a={},n=[].slice,r=/^#?\w+(?:[\-_]\w+)*$/i,i="WebkitAppearance"in document.documentElement.style||void 0!==document.webkitHidden,o="pushState"in history&&"replaceState"in history;e.support=o;var s=!1;if(e.VERSION="2.6.1",e.captureLink=!0,e.captureForm=!0,e.rootTransition=t,e.mergeCallback=!0,e.classAnimation="slide",e.classPage="page",e.classMask="mask",e.pushStateEnabled=!0,e.evalScript=!1,window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window&&(e.pushStateEnabled=!1),0==o)return e;history.popstate=!1,e.transition=function(t,r,s,c){if(0!=arguments.length&&t!=r){3==arguments.length&&1==isNaN(1*s)&&(s=(c=s).back),s=s||!1,c=c||{};var u={root:this.rootTransition,form:this.form||this.classAnimation,onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,preventdefault:this.preventdefault,fallback:this.fallback,callback:this.callback},d=function(t){if(!t||!t.getAttribute)return{};var a={},n=l(t.getAttribute("data-params")||"");return["title","root","form"].forEach(function(e){a[e]=t.getAttribute("data-"+e)||n[e]||c[e]||u[e]}),"string"==typeof a.root&&(a.root=e.getFunction(a.root)),["onpagefirstinto","callback","fallback","animationstart","animationend","preventdefault"].forEach(function(r){if(1==e.mergeCallback&&"function"==typeof u[r]){var i=t.getAttribute("data-"+r)||n[r];a[r]="function"==typeof a.root[i]?function(){u[r].apply(this,arguments),a.root[i].apply(this,arguments)}:"function"==typeof c[r]?function(){u[r].apply(this,arguments),c[r].apply(this,arguments)}:u[r]}else a[r]=t.getAttribute("data-"+r)||n[r]||c[r]||u[r]}),a},f=d(r=r||null),p=d(t);if(null!=r&&r.classList){var m=f.preventdefault,h=!1;"string"==typeof m&&(m=f.root[m])}if(null!=t&&t.classList){var y=p.preventdefault,g=!1;"string"==typeof y&&(y=p.root[y])}if("function"==typeof m&&(h=m.call(f.root,t,r,c)),1==h&&m===y)return!1;if("function"==typeof y&&(g=y.call(p.root,t,r,c)),1==g)return!1;var v=function(t,e){1!=t.flagAniBind&&["animationstart","animationend"].forEach(function(a,n){var r=p[a],o="webkit"+a.replace(/^a|s|e/g,function(t){return t.toUpperCase()}),s=i?o:a;n&&t.addEventListener(s,function(){0==this.classList.contains("in")&&(this.style.display="none",1==this.removeSelf&&(this.parentElement.removeChild(this),this.removeSelf=null)),this.classList.remove(d(this).form)}),"string"==typeof r&&p.root[r]?t.addEventListener(s,function(){e.root[r].call(e.root,this,this.classList.contains("in")?"into":"out",c)}):"function"==typeof r&&t.addEventListener(s,function(){r.call(e.root,this,this.classList.contains("in")?"into":"out",c)}),t.flagAniBind=!0})};if(null!=r&&r.classList&&1!=h){r.classList.add(f.form),r.offsetWidth=r.offsetWidth,r.style.display="block",r.classList.add("out"),r.classList.remove("in"),r.classList[s?"add":"remove"]("reverse"),r.removeSelf=r.removeSelf||null,v(r,f);var b=f.fallback;"string"==typeof b&&(b=f.root[b]),"function"==typeof b&&b.call(f.root,t,r,c)}if(null!=t&&t.classList){var k=p.title,A=document.querySelector("h1"),E=document.querySelector("."+this.classPage);k&&!1!==c.title?(document.title=k,A&&(A.innerHTML=k,A.title=k)):E==t&&!r&&document.title&&t.setAttribute("data-title",document.title);var L=c.id||t.id,w=c.id||t.id;c.id&&(L=L.split("?")[0]);var S=a["_"+L];!1!==c.remove&&a[L]&&a[L]!=t&&(S&&a[S]&&1==c.reload&&(delete a[S],delete a["_"+L]),1==c.reload&&(t.removeSelf=!0),a[L]!=r?a[L].parentElement&&a[L].parentElement.removeChild(a[L]):r.removeSelf=!0,delete a[L]),r&&t.classList.add(p.form),t.offsetWidth=t.offsetWidth,t.style.display="block",t.classList.remove("out"),t.classList.add("in"),t.classList[s?"add":"remove"]("reverse");var T=p.onpagefirstinto;t.firstintoBind||("string"==typeof T&&p.root[T]?p.root[T].call(p.root,t,r,c):"function"==typeof T&&T.call(p.root,t,r,c),n.call(t.querySelectorAll("form")).forEach(function(t){e.submit(t)}),t.firstintoBind=!0),v(t,p);var B,C=w;C&&0==/^#/.test(C)&&(C="#"+C),B=C.replace(/^#/,"#&"),o&&this.pushStateEnabled&&!1!==c.history&&C&&B!=location.hash&&(history.popstate=!1,history[r?"pushState":"replaceState"](null,document.title,C.replace(/^#/,"#&"))),a[L]||(a[L]=t,w!==L&&(a[w]=t,a["_"+L]=w));var P=p.callback;"string"==typeof P&&(P=p.root[P]),"function"==typeof P&&P.call(p.root,t,r,c),setTimeout(function(){history.popstate=!0},17)}}},e.getCleanUrl=function(t,e,a){var r="",i="",o="";if(t)if(1==t.nodeType)if(t.action){if(r=t.getAttribute("action"),t.method&&"POST"==t.method.toUpperCase())return r;window.$&&$.fn&&$.fn.serialize?i=$(t).serialize():(i={},n.call(t.querySelectorAll("input,select,textarea")).forEach(function(t){if(t.name&&!t.disabled){var e=t.value.trim(),a=t.name;/^radio|checkbox/i.test(t.type)?t.checked&&(i[a]?i[a].push(e):i[a]=[e]):i[a]=[e]}}))}else{r=t.getAttribute("href"),i=t.getAttribute("data-formdata")||t.getAttribute("data-data")||"";var s=t.getAttribute("data-container");if(-1==i.indexOf("container")&&s){var l="container="+s;i=i?i+"&"+l:l}}else t.url&&(r=t.url,i=t.data);if(!(r=r||e))return"";if("object"==typeof(i=i||a||"")){var c=[];for(key in i)i[key].forEach||(i[key]=[i[key]]),i[key].forEach(function(t){c.push(key+"="+encodeURIComponent(t))});i=c.length>0?c.join("&"):""}return"?"==(o=r.split("#")[0].replace(/&+$/,"")).slice(-1)&&(o=o.split("?")[0]),""!=i&&(/\?/.test(o)?o=o+"&"+(i=i.replace(/^&|\?/,"")):""!=i&&(o=o+"?"+(i=i.replace("?","")))),o},e.createPage=function(t,a,r){var i=null,o=null,s=this.classPage,l=null;if(t){void 0===r&&"object"==typeof a&&(r=a),r=r||{};var c,u,d,f={};a&&(1==a.nodeType?((a.href||a.action)&&(c=a.getAttribute("data-title")||r.title),i=r.response,u=a.getAttribute("data-container"),o=document.getElementById(u),d=a.getAttribute("data-classpage"),f.target=a,l=a.getAttribute("data-reload"),("form"==a.tagName.toLowerCase()||null!==l&&"false"!=l)&&(f.reload=!0),f.back="back"==a.getAttribute("data-rel"),"false"==a.getAttribute("data-history")&&(f.history=!1)):(i=a.response||r.response,c=a.title||r.title,o=a.container||r.container,d=a.classPage||r.classPage,f.target=a.target,f.back=a.back||r.back),o&&d&&(s=d));var p=(s==d?o:document).querySelector(".in."+s),m=null,h=document.createElement("div");"string"==typeof t?h.innerHTML=t:h.appendChild(t),1==e.evalScript&&1!=t.firstintoBind&&n.call(h.getElementsByTagName("script")).forEach(function(t){var e=t.innerHTML.trim(),a=t.getAttribute("type");if(""!=e.trim()&&!t.src){var n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");a&&(r.type=a),r.appendChild(document.createTextNode(e)),setTimeout(function(){n.insertBefore(r,n.firstChild),n.removeChild(r),r=null},17),t=null}});var y=h.getElementsByTagName("title")[0];(m=h.querySelector("."+s))||(h.className=s+" out",m=h),"string"==typeof c?m.setAttribute("data-title",c):y&&y.innerText&&m.setAttribute("data-title",y.innerText),(o||document.body).appendChild(m),h=null,f.response=i||t,f.id=this.getCleanUrl(a)||m.id||"unique"+Date.now(),"object"==typeof r&&(void 0!==r.history&&(f.history=r.history),void 0!==r.remove&&(f.remove=r.remove),void 0!==r.target&&(f.target=r.target),void 0!==r.title&&(f.title=r.title)),s==d&&(f.history=!1,f.classPage=s),this.transition(m,p,f)}},e.getFunction=function(e){if("string"==typeof e){for(var a=t,n=e.split("."),r=0;r<n.length&&(a=a[n[r]]);r+=1);return a}},e.ajax=function(t){if(t){var a,n={url:"",type:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},r={},i=null,o=null,s={};if(1==t.nodeType){for(key in s=l(t.getAttribute("data-params")||""),n)r[key]=t.getAttribute("data-"+key)||s[key]||n[key],"function"==typeof n[key]&&"string"==typeof r[key]&&(r[key]=this.getFunction(r[key]),"function"!=typeof r[key]&&(r[key]=n[key]));r.url=this.getCleanUrl(t,r.url),r.target=t,r.back="back"==t.getAttribute("data-rel");var c=t.tagName.toLowerCase();if("form"==c)r.type=t.method,o=new FormData(t);else if("a"==c){var u=t.getAttribute("data-container"),d=t.getAttribute("data-classpage"),f=u&&document.getElementById(u);f&&d&&d!=e.classPage&&(r.history=!1,r.title=!1)}"true"!=(a=t.getAttribute("data-mask"))&&""!=a||(i=t.querySelector("."+this.classMask))}else{if(!t.url)return;for(key2 in n)r[key2]=t[key2]||n[key2];r.url=this.getCleanUrl(null,r.url,r.data),r.title=t.title,r.back=t.back,r.container=t.container}var p=f||document.body;"string"!=typeof a&&(i=p.querySelector("."+this.classMask)),null==i&&((i=document.createElement("div")).className=this.classMask,i.innerHTML='<i class="loading"></i>',"string"==typeof a?t.appendChild(i):p.appendChild(i)),i.style.display="block";var m=new XMLHttpRequest;m.open(r.type||"GET",r.url+(/\?/.test(r.url)?"&":"?")+"r="+Date.now(),r.async,r.username,r.password),m.timeout=r.timeout,m.onload=function(){var a=null;if(200==m.status){if("json"==r.dataType||"JSON"==r.dataType)try{a=JSON.parse(m.response),r.response=a,e.createPage(e.jsonHandle(a),t,r)}catch(n){r.message="JSON parse error\uff1a"+n.message,r.error.call(r,m,m.status)}else if("unknown"==r.dataType){r.history=!1;try{a=JSON.parse(m.response),r.response=a,e.createPage(e.jsonHandle(a),t,r)}catch(n){e.createPage(a=m.response,t,r)}}else e.createPage(a=m.response,t,r);r.success.call(r,a,m.status)}else r.message="The status code exception!",r.error.call(r,m,m.status);r.complete.call(r,m,m.status),i.style.display="none"},m.onerror=function(t){r.message="Illegal request address or an unexpected network error!",r.error.call(r,m,m.status),i.style.display="none"},m.ontimeout=function(){r.message="The request timeout!",r.error.call(r,m,m.status),i.style.display="none"},m.setRequestHeader("Type","ajax"),m.setRequestHeader("From","mobilebone"),m.send(o)}},e.submit=function(t){if(t&&"string"==typeof t.action){var a=t.getAttribute("data-ajax");"false"==a||0==e.captureForm&&"true"!=a||t.addEventListener("submit",function(t){var a=this.getAttribute("data-preventdefault"),n=e.getFunction(a);if("function"==typeof n&&1==n(this))return t.preventDefault(),!1;e.ajax(this),t.preventDefault()})}},e.isBack=function(t,e){return 1==history.tempBack?(history.tempBack=null,!0):void 0===t||!!e&&4==t.compareDocumentPosition(e)},e.jsonHandle=function(t){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},e.init=function(){if(1==s)return"Don't repeat initialization!";var a=location.hash.replace("#&","#"),n=null,i=null;""==a||"#"==a?this.transition(document.querySelector("."+this.classPage)):1==r.test(a)&&(n=document.querySelector(a))&&n.classList.contains(this.classPage)?this.transition(n):(2==a.split("container=").length&&(i=document.getElementById(a.split("container=")[1].split("&")[0])),this.ajax({url:a.replace("#",""),dataType:"unknown",container:i,error:function(){n=document.querySelector("."+e.classPage),e.transition(n)}}));var o=t.$||t.jQuery||t.Zepto;o&&o.fn&&o.fn.tap&&"ontouchstart"in window==1?(o(document).tap(this.handleTapEvent),document.addEventListener("click",function(t){var a=t.target;if(a&&("a"==a.tagName.toLowerCase()||(a=a.getParentElementByTag("a")))){var n=a.getAttribute("data-ajax"),r=a.href;"external"==a.getAttribute("data-rel")||"false"==n||r.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0]&&"true"!=n||0==e.captureLink&&"true"!=n?/^http/i.test(r)&&(location.href=r):t.preventDefault()}})):document.addEventListener("click",this.handleTapEvent);var l=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&void 0!==document.hidden&&!window.chrome;"ontouchstart"in window==1&&l&&(document.addEventListener("touchmove",function(){history.popstateswipe=!0}),document.addEventListener("touchend",function(){history.popstateswipe=!1})),s=!0},e.handleTapEvent=function(t){var n=null;t&&1==t.nodeType&&((n=t).preventDefault=function(){}),n=n||t.target||t.touches[0],href=n.href,href&&0!=/a/i.test(n.tagName)||!(n=n.getParentElementByTag("a"))||(href=n.href);var r=document.querySelector(".in."+e.classPage);if(null!=r&&n){var i={target:n},o=n.getAttribute("data-preventdefault")||l(n.getAttribute("data-params")||"").preventdefault,s=e.getFunction(o);if("function"==typeof s&&1==s(n))return t.preventDefault(),!1;var c=n.getElementsByClassName(e.classMask)[0];if(c&&"none"!=c.style.display)return t.preventDefault(),!1;var u=n.getAttribute("data-container"),d=n.getAttribute("data-classpage"),f=u&&document.getElementById(u);f&&d&&d!=e.classPage&&(r=f.querySelector(".in."+d)||f.querySelector(d),i.history=!1,i.title=!1,i.classPage=d);var p=1==e.captureLink,m=n.getAttribute("data-rel"),h=!1;"back"==m&&(h=!0);var y="external"==m;if(href)if(href=href.replace("#&","#"),""!==n.getAttribute("href").replace(/#/g,"")){if(/^javascript/.test(href)){if(0==h)return}else if((1==(y=y||href.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0])||0==p)&&"true"!=n.getAttribute("data-ajax"))return;if(1==/^#/.test(n.getAttribute("href"))){var g=href.split("#")[1],v=g&&document.getElementById(g);0==h&&"auto"==m&&(h=e.isBack(v,r)),v&&e.transition(v,r,h,i),t.preventDefault()}else if(/^javascript/.test(href))history.tempBack=!0,history.back();else if("false"!=n.getAttribute("data-ajax")){var b=e.getCleanUrl(n),k=n.getAttribute("data-reload");if(n.getAttribute("href"),null!=k&&"false"!=k||!a[b])e.ajax(n);else{0==h&&"auto"==m&&(h=e.isBack(a[b],r)),i.id=b;var A=f||document.body;0==A.contains(a[b])&&A.appendChild(a[b]),e.transition(a[b],r,h,i)}t.preventDefault()}}else t.preventDefault()}},Element.prototype.getParentElementByTag=function(t){if(!t)return null;var e=null,a=this,n=function(){if(!(a=a.parentElement))return null;var r=a.tagName.toLowerCase();r===t?e=a:"body"==r?e=null:n()};return n(),e};var l=function(t){var e={};return"string"==typeof t&&t.split("&").forEach(function(t){var a=t.split("=");a.length>1&&(e[a[0]]=t.replace(a[0]+"=",""))}),e};return window.addEventListener("DOMContentLoaded",function(){0==s&&e.init()}),window.addEventListener("popstate",function(){if(1==history.popstateswipe)return location.reload(),void(history.popstateswipe=!1);if(0!=history.popstate){var t=location.hash.replace("#&","").replace(/^#/,""),n=null,i=null;if(""==t){if((n=document.querySelector("."+e.classPage)).id)return}else if(n=a[t],2==t.split("container=").length&&(i=document.getElementById(t.split("container=")[1].split("&")[0])),n&&0==r.test(t))return void e.createPage(n,{url:t,dataType:"unknown",history:!1,back:!0,container:i});if(!n){if(0==r.test(t))return void e.ajax({url:t,dataType:"unknown",back:e.isBack(),container:i});n=document.querySelector("#"+t)}var o=document.querySelector(".in."+e.classPage);n&&n==o||0==e.pushStateEnabled||n&&e.transition(n,o,e.isBack(n,o),{id:t,history:!1,remove:!1})}else history.popstate=!0}),document.MBLOADED=!0,e});